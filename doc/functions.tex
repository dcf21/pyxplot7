% FUNCTIONS.TEX
%
% The documentation in this file is part of PyXPlot
% <http://www.pyxplot.org.uk>
%
% Copyright (C) 2006-7 Dominic Ford <coders@pyxplot.org.uk>
%
% $Id$
%
% PyXPlot is free software; you can redistribute it and/or modify it under the
% terms of the GNU General Public License as published by the Free Software
% Foundation; either version 2 of the License, or (at your option) any later
% version.
%
% You should have received a copy of the GNU General Public License along with
% PyXPlot; if not, write to the Free Software Foundation, Inc., 51 Franklin
% Street, Fifth Floor, Boston, MA  02110-1301, USA

% ----------------------------------------------------------------------------

% LaTeX source for the PyXPlot Users' Guide

\chapter{Functions}

This chapter describes some of the more advanced function-related features that
PyXPlot contains.

\section{Function Splicing}
\index{function splicing}
\index{splicing functions}

In PyXPlot, as in gnuplot, user-defined functions may be declared on the
command line:

\begin{verbatim}
f(x) = x*sin(x)
\end{verbatim}

\noindent As an extension to what is possible in gnuplot, it is also possible
to declare functions which are only valid over a certain range of argument
space. For example, the following function would only be valid in the range
$-2<x<2$:\footnote{The syntax \texttt{[-2:2]} can also be written \texttt{[-2
to 2]}.}

\begin{verbatim}
f(x)[-2:2] = x*sin(x)
\end{verbatim}

\noindent The following function would only be valid when all of ${a,b,c}$ were
in the range $-1 \to 1$:

\begin{verbatim}
f(a,b,c)[-1:1][-1:1][-1:1] = a+b+c
\end{verbatim}

If an attempt is made to evaluate a function outside of its specified range,
then an error results. This may be useful, for example, for plotting a
function, but not continuing it outside some specified range. The following
would print the function $\sin(x)$, but only in the range $-2<x<7$:

\begin{verbatim}
f(x)[-2:7] = sin(x)
plot f(x)
\end{verbatim}

\begin{figure}
\begin{center}
\includegraphics{examples/eps/ex_funcsplice1.eps}
\end{center}
\caption{A simple example of the use of function splicing to truncate the function $\sin(x)$ at $x=-2$ and $x=7$. See details in the text.}
\label{fig:ex_funcsplice1}
\end{figure}

\label{splice} \noindent The output of this particular example can be seen in
Figure~\ref{fig:ex_funcsplice1}. A similar effect could also have been achieved
with the \texttt{select} keyword; see Section~\ref{select_modifier}.

It is possible to make multiple declarations of the same function, over
different regions of argument space; if there is an overlap in the valid
argument space for multiple definitions, then later declarations take
precedence. This makes it possible to use different functional forms for a
function in different parts of parameter space, and is especially useful when
fitting a function to data, if different functional forms are to be spliced
together to fit different regimes in the data.

Another application of function splicing is to work with functions which do not
have analytic forms, or which are, by definition, discontinuous, such as
top-hat functions or Heaviside functions. The following example would define
$f(x)$ to be a Heaviside function:

\begin{verbatim}
f(x) = 0
f(x)[0:] = 1
\end{verbatim}

\noindent The following example would define $f(x)$ to follow the Fibonacci
sequence, though it is not at all computationally efficient, and it is
inadvisable to evaluate it for $x>8$:

\begin{verbatim}
f(x) = 1
f(x)[2:] = f(x-1) + f(x-2)
plot [0:8] f(x)
\end{verbatim}

\begin{figure}
\begin{center}
\includegraphics{examples/eps/ex_funcsplice2.eps}
\end{center}
\caption{An example of the use of function splicing to define a function which does not have an analytic form -- in this case, the Fibonacci sequence. See the text for details.}
\label{fig:ex_funcsplice2}
\end{figure}

\noindent The output of this example can be seen in Figure~\ref{fig:ex_funcsplice2}

\section{Datafile Interpolation: Spline Fitting}
\label{spline_command}
\index{best fit lines}

% The following is largely wrong, and hence commented out
%Gnuplot allows data to be interpolated using its \texttt{csplines} plot style,
%for example:\index{csplines plot style@\texttt{csplines} plot
%style}\index{acsplines plot style@\texttt{acsplines} plot style}
%
%\begin{verbatim}
%plot 'datafile' with smooth csplines
%plot 'datafile' with smooth acsplines
%\end{verbatim}
%
%\noindent where the upper statement fits a spline through all of the
%datapoints, and the lower applies some smoothing to the data first. This syntax
%is supported in PyXPlot but deprecated.  A similar effect can be achieved with
%the new, more powerful, \texttt{spline} command\index{spline
%command@\texttt{spline} command}. This has a syntax similar to that of the
%\texttt{fit} command, for example:
The \texttt{spline} command\index{spline command@\texttt{spline} command} fits a
spline through data from a file.  For example:

\begin{verbatim}
spline f() 'datafile' index 1 using 2:3
\end{verbatim}

The function $f(x)$ now becomes a special function, representing a spline fit
to the given datafile. It can be plotted or otherwise used in exactly the same
way as any other function. This approach is more flexible than gnuplot's
syntax, as the spline $f(x)$ can subsequently be spliced together with other
functions (see the previous section), or used in any mathematical operation.
The following code snippet, for example, would fit splines through two
datasets, and then plot the interpolated differences between them, regardless,
for example, of whether the two datasets were sampled at exactly the same $x$
coordinates:

\begin{verbatim}
spline f() 'datafile1'
spline g() 'datafile2'
plot f(x)-g(x)
\end{verbatim}

Smoothed splines can also be produced:

\begin{verbatim}
spline f() 'datafile1' smooth 1.0
\end{verbatim}

\noindent where the value $1.0$ determines the degree of smoothing to apply;
the higher the value, the more smoothing is applied. The default behaviour is
not to smooth at all (equivalent to \texttt{smooth 0.0}); a value of $1.0$
corresponds to the default amount of smoothing applied in the
gnuplot \texttt{acsplines} plot style.

\section{Numerical Integration and Differentiation}

Special functions are available for performing numerical integration and
differentiation of expressions: \texttt{int\_dx()} and
\texttt{diff\_dx()}\index{differentiation}\index{integration}\index{int\_dx()
function@\texttt{int\_dx()} function}\index{diff\_dx()
function@\texttt{diff\_dx()} function}. In each case, the ``\texttt{x}'' may be
replaced with any valid variable name, to integrate or differentiate with
respect to any given variable.

The function \texttt{int\_dx()} takes three parameters -- firstly the
expression to be integrated, followed by the minimum and maximum integration
limits. For example, the following would plot the integral of the function
$\sin(x)$:

\begin{verbatim}
plot int_dt(sin(t),0,x)
\end{verbatim} 

The function \texttt{diff\_dx()} takes two obligatory parameters plus two
further optional parameters. The first is the expression to be differentiated,
followed by the point at which the differential should be evaluated, following
by optional parameters $\epsilon_1$ and $\epsilon_2$, which are described
below.  The following example would evaluate the differential of the function
$\cos(x)$ with respect to $x$ at $x=1.0$:

\begin{verbatim}
print diff_dx(cos(x), 1.0)
\end{verbatim}

Differentials are evaluated by a simple differencing algorithm, and a parameter
$\epsilon$ controls the spacing with which to perform the differencing
operation:

\begin{displaymath}
\left.\frac{\mathrm{d}f}{\mathrm{d}x}\right|_{x=x_0} \approx \frac{f(x_0+\epsilon/2) - f(x_0-\epsilon/2)}{\epsilon}
\end{displaymath}

\noindent where $\epsilon = \epsilon_1 + x \epsilon_2$. By default, $\epsilon_1
= \epsilon_2 = 10^{-6}$, which is appropriate for the differentiation of most
well-behaved functions.

Advanced users may be interested to know that integration is performed using
the \texttt{quad} function of the \texttt{integrate} package of the
\texttt{scipy} numerical toolkit for Python -- a general purpose integration
routine.

\section{Histograms}

The \texttt{histogram}\index{histogram command@\texttt{histogram} command}
command takes data from a datafile and bins it, producing a function that
represents a histogram of the supplied data.  A histogram is defined as a
function consisting of discrete intervals, the area under which is equal to the
number of points binned in that interval.  For example

\begin{verbatim}
histogram f() 'data'
\end{verbatim}

\noindent would bin the points in the first column of the file {\tt data} into bins of
unit width and produce a function $f()$, the value of which at a given point was
equal to the number of items in the bin at that point.

Three modifiers can be supplied to the {\tt histogram} command.  The {\tt
binwidth} modifier sets the width of the bins used and the {\tt binorigin}
modifier their origin.   Alternatively the {\tt bins} modifier allows an
arbitrary set of bins to be specified.  For example the command

\begin{verbatim}
histogram g() 'data' bins (1, 2, 4)
\end{verbatim}

\noindent would bin the points in the first column of the file {\tt data} into
two bins, 1 to 2 and 2 to 4.

A range can be supplied immediately following the command according to the usual
syntax; only points that fall in that range will then be binned.  In the same
way as for the {\tt plot} command the {\tt index}, {\tt every}, {\tt using} and
{\tt select} modifiers can also be used to bin different portions of the
datafile.
